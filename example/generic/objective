#! /usr/bin/env coffee

{objective, Objective} = require '../../lib/nez'

#
# cd example/generic
# ./objective
#

objective

    title: 'Objective ABC'
    uuid:  '00000000-0000-0000-0001-000000000001'
    description: """

    Does things A, B and C

    """

    listen: 
        secret:  'S3CR3T'
        address: 'localhost'
        port:     9000
        cert:     '../cert/develop-cert.pem'
        key:      '../cert/develop-key.pem'

    boundry: ['process']

    class: class extends Objective

        startScheduler: (monitor, @jobTokens, @jobEmitter) ->

            monitor.realizers.on 'connect', (realizer) -> 

                #
                # init the remote realizer on connect
                #

                realizer.notice.event 'init'

                # 
                # hmmm. ->> 
                # 
                # realizer.notice.event( 'init' ).reply (msg) -> 
                #     console.log INIT_REPLY: msg
                # 

            monitor.realizers.on 'ready', (realizer) -> 

                console.log READY: realizer


            monitor.realizers.on 'error', (realizer, msg) -> 

                console.log ERROR: realizer




            # monitor.realizers.on 'reconnect', (realizer) -> 

            #     console.log RECONNECTED: realizer

            # monitor.realizers.on 'disconnect', (realizer) -> 

            #     console.log DISCONNECTED: realizer

            # setInterval (=>

            #     for path of @jobTokens
                    
            #         do( token = @jobTokens[path] ) ->

            #             monitor.realizers.get( uuid: token.uuid ).then(

            #                 (realizer) -> 

            #                     console.log token.uuid, connected: realizer.connected

            #                 (error) -> 

            #                     console.log ERROR: error

            #             ) if token.type == 'tree'

            # ), 2000


    (process) -> 

        process.link directory: 'processes'
