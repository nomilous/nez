#! /usr/bin/env coffee

{objective, Objective} = require '../../lib/nez'

#
# cd example/generic
# ./objective
#

objective

    title: 'Objective ABC'
    uuid:  '00000000-0000-0000-0001-000000000001'
    description: """

    Does things A, B and C

    """

    listen: 
        secret:  'S3CR3T'
        address: 'localhost'
        port:     9000
        cert:     '../cert/develop-cert.pem'
        key:      '../cert/develop-key.pem'

    boundry: ['process']

    # autoload: false
    # autorun: true

    class: class Generic extends Objective

        startScheduler: (monitor, @jobTokens, @jobEmitter) ->

            #
            # TODO: likely remove jobEmitter (it's silly)
            #

            monitor.realizers.on 'connect',    (realizer) -> 
            monitor.realizers.on 'disconnect', (realizer) -> 
            monitor.realizers.on 'reconnect',  (realizer) ->  
            monitor.realizers.on 'ready',      (realizer, seq) -> 

                console.log 
                    SEQ:   seq
                    READY: realizer
                    

            monitor.realizers.on 'error', (realizer, msg) -> 

                console.log ERROR: realizer


            # setInterval (=>

            #     for path of @jobTokens
                    
            #         do( token = @jobTokens[path] ) ->

            #             monitor.realizers.get( uuid: token.uuid ).then(

            #                 (realizer) -> 

            #                     console.log token.uuid, connected: realizer.connected

            #                 (error) -> 

            #                     console.log ERROR: error

            #             ) if token.type == 'tree'

            # ), 2000


    (process) -> 

        process.link directory: 'processes'
