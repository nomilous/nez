// Generated by CoffeeScript 1.6.3
var Notice, Phrase, Realizers;

Notice = require('notice');

Phrase = require('phrase');

Realizers = require('../realization/realizers');

module.exports = function(opts, objectiveFn) {
  var missing, required;
  if (objectiveFn == null) {
    objectiveFn = function(end) {};
  }
  missing = (function() {
    var _i, _len, _ref, _results;
    _ref = ['title', 'uuid', 'description'];
    _results = [];
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      required = _ref[_i];
      if (opts[required] != null) {
        continue;
      }
      _results.push(required);
    }
    return _results;
  })();
  if (missing.length > 0) {
    console.log("objective(opts, objectiveFn) requires " + (missing.map(function(p) {
      return "opts." + p;
    }).join(', ')));
    process.exit(2);
  }
  return Notice.listen("objective/" + opts.uuid, opts, function(error, realizerHub) {
    if (error != null) {
      try {
        delete opts.listen.secret;
      } catch (_error) {}
      try {
        delete opts.listening;
      } catch (_error) {}
      console.log({
        OPTS: opts,
        ERROR: error
      });
      process.exit(1);
    }
    return Phrase.createRoot(opts, function(objectiveToken, objectiveNotice) {
      return Realizers.createCollection(opts, realizerHub, objectiveToken, objectiveNotice);
    })('objective', objectiveFn);
  });
};
