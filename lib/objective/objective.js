// Generated by CoffeeScript 1.6.3
var eo, inject, notice;

notice = require('notice');

eo = require('eo');

inject = require('also').inject;

module.exports = function(title, opts, objectiveFn) {
  var key, objective, options;
  if (typeof title !== 'string') {
    throw new Error('objective(title, opts, fn) requires title as string');
  }
  if (typeof opts === 'function') {
    objectiveFn = opts;
    opts = {};
  }
  if (typeof objectiveFn !== 'function') {
    throw new Error('objective(title, opts, fn) requires function as last argument');
  }
  options = {
    title: title
  };
  options.tools = require('../tools');
  for (key in opts) {
    options[key] = opts[key];
  }
  objective = inject.async({
    beforeAll: function(done, inject) {
      inject.first[0] = notice.listen('realizers', options, function(error) {
        return done(error);
      });
      return inject.first[1] = notice.create('objective', opts.messenger || eo.messenger);
    },
    error: options.error || (console.log('WARNING', 'objective without error handler'), function(error) {
      return console.log('ERROR', error);
    })
  }, eo);
  return objective(objectiveFn);
};
