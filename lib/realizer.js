// Generated by CoffeeScript 1.4.0
var AssertionError, Realizer;

AssertionError = require('assert').AssertionError;

require('fing');

Realizer = (function() {

  function Realizer() {}

  Realizer.realizers = {};

  Realizer.createFunction = function(name, object, configuration, realization) {
    var key, originalFunction, realizer;
    key = object.fing.ref + ':' + name;
    if (this.realizers[key]) {
      this.realizers[key].realizations.push(realization);
      return;
    }
    originalFunction = this.getOriginal(name, object);
    this.realizers[key] = {
      object: object,
      original: originalFunction,
      config: configuration,
      realizations: []
    };
    realizer = function(arg1, arg2, arg3, arg4, arg5, arg6, arg7, arg8, areYouMad) {
      var config, original, realizerCallback;
      object = Realizer.realizers[key].object;
      config = Realizer.realizers[key].config;
      original = Realizer.realizers[key].original;
      realizerCallback = Realizer.realizers[key].realizations.shift();
      if (typeof realizerCallback === 'undefined') {
        throw new AssertionError({
          message: 'Unexpected call to ' + key
        });
      }
      realizerCallback({
        object: object,
        args: arguments
      });
      if (config.as === 'spy') {
        return original(arg1, arg2, arg3, arg4, arg5, arg6, arg7, arg8, areYouMad);
      }
      return config.returning;
    };
    this.replaceOriginal(name, object, realizer);
    return this.realizers[key].realizations.push(realization);
  };

  Realizer.createProperty = function(name, object, configuration, realization) {
    var target;
    target = this.createTarget(object);
    return Object.defineProperty(target, name, {
      get: function() {
        return 'value';
      },
      set: function(value) {}
    });
  };

  Realizer.createTarget = function(object) {
    if (object.fing.type === 'prototype') {
      return object.prototype;
    } else {
      return object;
    }
  };

  Realizer.getOriginal = function(name, object) {
    var originalFunction;
    if (object.fing.type === 'prototype') {
      return originalFunction = object.prototype[name];
    } else {
      return originalFunction = object[name];
    }
  };

  Realizer.replaceOriginal = function(name, object, fn) {
    if (object.fing.type === 'prototype') {
      return object.prototype[name] = fn;
    } else {
      return object[name] = fn;
    }
  };

  return Realizer;

})();

module.exports = Realizer;
